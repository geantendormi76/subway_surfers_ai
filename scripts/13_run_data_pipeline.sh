#!/bin/bash
# ==============================================================================
# 脚本功能: 决策模型数据处理与训练的完整自动化流水线。
#           依次执行：CFR转换 -> 模型预标注 -> DTW对齐 -> 轨迹生成 -> 数据集划分 -> 模型训练
# ==============================================================================

set -e # 如果任何命令失败，则立即退出脚本

echo -e "\033[1;36m--- [阶段 1/6] 开始视频标准化 (CFR) ---\033[0m"
./scripts/07_cfr_yuchuli.sh
echo -e "\033[1;32m--- [阶段 1/6] 视频标准化完成 ---\033[0m\n"

echo -e "\033[1;36m--- [阶段 2/6] 开始模型辅助预标注 ---\033[0m"
./scripts/10_run_model_annotation.sh
echo -e "\033[1;32m--- [阶段 2/6] 模型辅助预标注完成 ---\033[0m\n"

echo -e "\033[1;36m--- [阶段 3/6] 开始DTW动态时序对齐 ---\033[0m"
./scripts/11_run_dtw_alignment.sh
echo -e "\033[1;32m--- [阶段 3/6] DTW对齐完成 ---\033[0m\n"

echo -e "\033[1;36m--- [阶段 4/6] 开始生成最终轨迹文件 ---\033[0m"
python scripts/12_generate_final_trajectories.py
echo -e "\033[1;32m--- [阶段 4/6] 轨迹文件生成完成 ---\033[0m\n"

echo -e "\033[1;36m--- [阶段 5/6] 开始划分训练集和验证集 ---\033[0m"
python scripts/14_split_trajectories.py
echo -e "\033[1;32m--- [阶段 5/6] 数据集划分完成 ---\033[0m\n"

echo -e "\033[1;36m--- [阶段 6/6] 开始训练决策模型 ---\033[0m"
python train_decision_model.py --config decision_model_config.yaml
echo -e "\033[1;32m--- [阶段 6/6] 决策模型训练完成 ---\033[0m\n"

echo -e "\033[1;35m🎉🎉🎉 完整流水线执行成功！新的决策模型已准备就绪。 🎉🎉🎉\033[0m"